\documentclass{article}

\usepackage{pgfplots}
\pgfplotsset{width=0.7\linewidth,compat=1.18}
\usepackage{tikzviolinplots}
\usepgfplotslibrary{external}
\tikzexternalize
\usepackage{minted}
\usemintedstyle{tango}
\usepackage{amsmath}
\usepackage{hyperref}

\begin{filecontents*}{example.dat}
A	B	C	D	E
0.3	-2.1	3.50	2.89	1.00
0.41	-1.9	3.55	2.88	1.06
0.45	-1.5	3.55	3.13	1.00
0.46	-1.3	3.60	2.69	1.20
0.46	-1.3	3.60	2.78	1.00
0.46	-1.27	3.60	2.83	1.35
0.47	-1.26	3.65	3.08	1.00
0.47	-1.26	3.65	3.08	1.53
0.48	-1.24	3.65	2.73	1.00
0.51	-1.2	3.65	3.08	1.73
0.57	-1.13	3.65	3.24	1.00
2.3	-1.02	3.70	3.10	1.95
2.41	-0.9	3.70	2.98	1.00
2.46	-0.2	3.70	2.98	2.21
2.47	0.0	3.75	3.04	1.00
2.48	0.1	3.80	3.24	2.49
2.51	0.3	3.85	3.16	1.00
2.57	0.5	3.85	3.30	3.04
\end{filecontents*}

\title{The \texttt{tikzviolinplots} package}
\author{Pedro Callil}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
	The package provides commands for violin plot creation and
	the kernel density estimations required.
\end{abstract}

\section{Introduction}

This package, through the use of the package \texttt{pgfplots}, allows the
creation of violin plots in \LaTeX. Violin plots are similar to boxplots,
but instead of a box signalling the average and quartiles, a kernel density
estimator is plotted, as in formula \ref{eq:kde}, in which the kernel is a
non negative function (chosen here as the normal distribution).

\begin{equation}
	\label{eq:kde}
	\textnormal{KDE}(x) = %
	\cfrac{1}{nh}\sum_{i=1}^n\textnormal{kernel}\left(\cfrac{x-x_i}{h}\right)
\end{equation}

\section{Usage}

To plot a violin plot with the commands provided, one must, inside
a \texttt{tikzpicture} environment, set the general options to all
plots and insert each individual dataset.

To set the general options, the command \texttt{{\textbackslash}violinsetoptions}
is provided, and must be invoked before plotting the datasets. This should
be done with the command \texttt{{\textbackslash}violinplot}.

\subsection{General options: \texttt{{\textbackslash}violinsetoptions}}

The command \texttt{{\textbackslash}violinsetoptions} takes three arguments,
an optional argument with package-specific options and two mandatory
arguments with options to be passed to \texttt{pgfplots}.

\begin{minted}[escapeinside=||]{latex}
	\violinsetoptions[|\textit{<package-specific options>}|]%
	{|\textit{<plot limits>}|}%
	{|\textit{<pgfplots general options>}|}
\end{minted}

\subsubsection{Package-specific options}

There are five options specific to the package: \texttt{scaled},
\texttt{data points}, \texttt{averages}, \texttt{no mirror} and
\texttt{reverse axis}, controlling how and which information
in the datasets should be presented.

The option \texttt{scaled} controls if all plots in the graph
have the same area or same width. If passed, the kernel
distribution estimations will be scaled to the same width, as
shown in figure \ref{graph:violin_verti}; otherwise, the plots
will present the same area, as in figure \ref{graph:violin_horiz}.

The option \texttt{data points}, if passed, will show, along with
the violin plots, the distribution of points in the data set, as shown in
figure \ref{graph:violin_verti}.

If the option \texttt{averages} is passed, the average of the data set
elements is shown, as in figure \ref{graph:violin_horiz}.

The plots are mirrored by default; however, passing the option \texttt{no mirror}
will show only half the plot, as shown in figure \ref{graph:violin_horiz}.

Finally, to ``transpose'' the plots (\textit{i.e.} show the distributions
as functions of the abcissa, as in figure \ref{graph:violin_horiz},
and not as functions of ordinate, as in figure \ref{graph:violin_verti}),
one might use the option \texttt{reverse axis}.

\subsubsection{Plot limits and other \texttt{pgfplots} options}

The minima and maxima of the plot axes are set in the second (and first
mandatory) argument to the command, and should follow \texttt{pgfplots}
syntax. For instance, to set the minimum and maximum of the $x$-axis
to -3 and 6, and of the $y$-axis to 2.5 and 7, one might use:

\begin{minted}[escapeinside=||]{latex}
	\violinsetoptions[|\textit{<package-specific options>}|]%
	{xmin=-3, xmax=6, ymin=2.5, xmin=7,}%
	{|\textit{<pgfplots general options>}|}
\end{minted}

Other \texttt{pgfplots} expressions such as title or axes labels may be set
in the same way in the next argument.

\subsection{Options for each data set: \texttt{{\textbackslash}violinplot}}

This command takes one mandatory argument, and a list of options:

\begin{minted}[escapeinside=||]{latex}
	\violinplot[%
		bandwidth=|\textit{bandwidth}|,
		index=|\textit{column name}|,
		samples=|\textit{\textnumero of samples}|,
		relative position=|\textit{relative position}|,
		color=|\textit{color}|,
		label=|\textit{label}|,
	]{|\textit{filename}|}
\end{minted}

The filename (mandatory argument) must be a path to a file storing the data as
space-separated columns, identified, in the file, with the column name passed as
the option \texttt{index}.

The options available are the \texttt{bandwith} of the kernel density estimator
($h$ in equation \ref{eq:kde}), the name of the column with the data,
the number of points (\texttt{samples}) in which the density shall be
calculated, the position of the plot in the axis orthogonal to the argument
of the function (the $x$-axis if the option \texttt{reverse axis} is not
passed to \texttt{{\textbackslash}violinsetoptions} and the $y$-axis otherwise),
the \texttt{color} of the plot and its \texttt{label}.

\section{Example}

To show the usage of the package, we plotted several data sets two times, in
figures \ref{graph:violin_verti} and \ref{graph:violin_horiz}.

\begin{figure}[h]
	\centering
	\begin{tikzpicture}
		\violinsetoptions[
			data points,
			scaled,
		]{
			xmin=0,xmax=6,
			ymin=-4,ymax=6,
		}{
			title={Plotting Some Data},
			xlabel={Groups},
			ylabel={Some property},
			xlabel style={
				yshift = {-2*height("a")}
			},
			ymajorgrids=true,
		};
		\violinplot[%
			index=C,
			relative position=1,
			color=orange!0!black,
			label={$\alpha$},
		]{example.dat};
		\violinplot[%
			index=B,
			relative position=2,
			color=orange!25!black,
			label={$\beta$},
		]{example.dat};
		\violinplot[%
			bandwidth=0.5,
			index=A,
			relative position=3,
			color=orange!50!black,
			label={$\gamma$},
		]{example.dat};
		\violinplot[%
			index=D,
			relative position=4,
			color=orange!75!black,
			label={$\delta$}
		]{example.dat};
		\violinplot[%
			bandwidth=0.3,
			index=E,
			relative position=5,
			color=orange!100!black,
			label={$\epsilon$}
		]{example.dat};
	\end{tikzpicture}
	\caption{Violin plot -- vertical example}
	\label{graph:violin_verti}
\end{figure}

Code for figure \ref{graph:violin_verti}:

\colorlet{mintedbgverti}{orange!10!white}

\begin{minted}[bgcolor=mintedbgverti]{latex}

	\begin{tikzpicture}
		\violinsetoptions[
			data points,
			scaled,
		]{
			xmin=0,xmax=6,
			ymin=-4,ymax=6,
		}{
			title={Plotting Some Data},
			xlabel={Groups},
			ylabel={Some property},
			xlabel style={
				yshift = {-2*height("a")}
			},
			ymajorgrids=true,
		};
		\violinplot[%
			index=C,
			relative position=1,
			color=orange!0!black,
			label={$\alpha$},
		]{example.dat};
		\violinplot[%
			index=B,
			relative position=2,
			color=orange!25!black,
			label={$\beta$},
		]{example.dat};
		\violinplot[%
			bandwidth=0.5,
			index=A,
			relative position=3,
			color=orange!50!black,
			label={$\gamma$},
		]{example.dat};
		\violinplot[%
			index=D,
			relative position=4,
			color=orange!75!black,
			label={$\delta$}
		]{example.dat};
		\violinplot[%
			bandwidth=0.3,
			index=E,
			relative position=5,
			color=orange!100!black,
			label={$\epsilon$}
		]{example.dat};
	\end{tikzpicture}

\end{minted}

\begin{figure}[h]
	\centering
	\begin{tikzpicture}
		\violinsetoptions[
			no mirror,
			averages,
			reverse axis,
		]{%
			xmin=-4,xmax=6,
			ymin=0.7,ymax=7,
		}{%
			title={Plotting Some Data},
			ylabel={Groups},
			xlabel={Some property},
			ylabel style={
				yshift = {2*width("a")}
			},
			xmajorgrids=true,
		};
		\violinplot[%
			index=C,
			relative position=1,
			color=blue!0!black,
			label={$\alpha$},
		]{example.dat};
		\violinplot[%
			index=B,
			relative position=2,
			color=blue!25!black,
			label={$\beta$},
		]{example.dat};
		\violinplot[%
			bandwidth=0.5,
			index=A,
			relative position=3,
			color=blue!50!black,
			label={$\gamma$},
		]{example.dat};
		\violinplot[%
			index=D,
			relative position=4,
			color=blue!75!black,
			label={$\delta$}
		]{example.dat};
		\violinplot[%
			bandwidth=0.3,
			index=E,
			relative position=5,
			color=blue!100!black,
			label={$\epsilon$}
		]{example.dat};
	\end{tikzpicture}
	\caption{Violin plot -- horizontal example}
	\label{graph:violin_horiz}
\end{figure}

Code for figure \ref{graph:violin_horiz}:

\colorlet{mintedbghoriz}{blue!10!white}

\begin{minted}[bgcolor=mintedbghoriz]{latex}
	\begin{tikzpicture}
		\violinsetoptions[
			no mirror,
			averages,
			reverse axis,
		]{%
			xmin=-4,xmax=6,
			ymin=0.7,ymax=7,
		}{%
			title={Plotting Some Data},
			ylabel={Groups},
			xlabel={Some property},
			ylabel style={
				yshift = {2*width("a")}
			},
			xmajorgrids=true,
		};
		\violinplot[%
			index=C,
			relative position=1,
			color=blue!0!black,
			label={$\alpha$},
		]{example.dat};
		\violinplot[%
			index=B,
			relative position=2,
			color=blue!25!black,
			label={$\beta$},
		]{example.dat};
		\violinplot[%
			bandwidth=0.5,
			index=A,
			relative position=3,
			color=blue!50!black,
			label={$\gamma$},
		]{example.dat};
		\violinplot[%
			index=D,
			relative position=4,
			color=blue!75!black,
			label={$\delta$}
		]{example.dat};
		\violinplot[%
			bandwidth=0.3,
			index=E,
			relative position=5,
			color=blue!100!black,
			label={$\epsilon$}
		]{example.dat};
	\end{tikzpicture}
\end{minted}

\end{document}
